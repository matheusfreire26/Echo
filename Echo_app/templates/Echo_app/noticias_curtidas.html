{% extends "Echo_app/base.html" %}
{% load static %}

{% block title %}Minhas Curtidas{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'Echo_app/css/lista_noticias_jornal.css' %}?v={% now 'U' %}">

<!-- CSS EXTRA PARA GARANTIR QUE O CLIQUE FUNCIONE (IGNORANDO SOBREPOSIÇÕES) -->
<style>
    .filter-section {
        position: relative;
        z-index: 1000; /* Garante que fique acima de tudo */
        display: flex;
        flex-direction: column;
        gap: 15px; 
        margin-bottom: 25px;
    }
    
    .category-filters {
        display: flex;
        flex-wrap: nowrap; 
        overflow-x: auto; 
        padding-bottom: 10px;
        gap: 10px;
    }

    .filter-button {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px; 
        border: 1px solid #ccc; 
        background-color: #fff;
        color: #333;
        text-decoration: none;
        font-weight: 500;
        white-space: nowrap;
        cursor: pointer;
    }
    
    .filter-button:hover {
        background-color: #f0f0f0;
    }
    
    /* ESTILO DO BOTÃO ATIVO (VERMELHO) */
    .filter-button.active {
        background-color: #cc0000; 
        color: white;
        border-color: #cc0000;
    }
</style>
{% endblock %}

{% block content %}

<div class="content-container">

    <h1 class="main-title">Minhas Curtidas</h1>
    
    <!-- SEÇÃO DE FILTROS -->
    <div class="filter-section">
        
        <!-- BARRA DE PESQUISA -->
        <form method="GET" class="search-form" action="{% url 'Echo_app:noticias_curtidas' %}">
            <input type="text" name="q" placeholder="Pesquisar..." class="search-input" value="{{ request.GET.q|default:'' }}">
            
            <!-- Se já tem categoria selecionada, mantém ela ao pesquisar -->
            {% if categoria_ativa %}
                <input type="hidden" name="categoria" value="{{ categoria_ativa }}">
            {% endif %}

            <button type="submit" class="search-button">
                <i class="fas fa-search"></i>
            </button>
        </form>
        
        <!-- BOTÕES DE CATEGORIA -->
        <div class="category-filters">
            
            <!-- URL base para facilitar -->
            {% url 'Echo_app:noticias_curtidas' as base_url %}
            
            <!-- 1. BOTÃO TUDO -->
            <!-- Se 'categoria_ativa' estiver vazio, este botão ganha a classe 'active' -->
            <a href="{{ base_url }}?q={{ request.GET.q }}" 
               class="filter-button {% if not categoria_ativa %}active{% endif %}">
                Tudo
            </a>
            
            <!-- 2. BOTÕES DAS OUTRAS CATEGORIAS -->
            {% for cat in categorias_disponiveis %}
                <!-- 
                    Link envia: ?categoria=NOME_DA_CATEGORIA 
                    Se categoria_ativa for igual ao nome desta categoria, adiciona classe 'active'
                -->
                <a href="{{ base_url }}?categoria={{ cat.nome }}&q={{ request.GET.q }}" 
                   class="filter-button {% if categoria_ativa == cat.nome %}active{% endif %}">
                    {{ cat.nome }}
                </a>
            {% endfor %}

        </div>
    </div>

    <!-- HEADER COM CONTADOR -->
    <div class="curtidas-header">
        <p class="curtidas-info">
            {% if categoria_ativa %}
                Filtrando por: <strong>{{ categoria_ativa }}</strong>.
            {% endif %}
            Total: <strong>{{ total_curtidas }}</strong> notícias.
        </p>
    </div>

    <!-- LISTA DE NOTÍCIAS -->
    {% if noticias_curtidas %}
        <div class="noticias-listagem">
            {% for noticia in noticias_curtidas %}
            <article class="noticia-item">
                <a href="{% url 'Echo_app:noticia_detalhe' pk=noticia.pk %}" class="noticia-link">
                    
                    <div class="noticia-imagem-box">
                        {% if noticia.imagem %}
                            <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}" class="noticia-imagem">
                        {% else %}
                            <div class="imagem-placeholder"><span>Sem Imagem</span></div>
                        {% endif %}
                    </div>
                    
                    <div class="noticia-body">
                        <span class="noticia-tag">{{ noticia.categoria.nome|default:"Geral" }}</span>
                        <h2 class="noticia-titulo">{{ noticia.titulo }}</h2>
                        <p class="noticia-resumo">{{ noticia.conteudo|striptags|truncatechars:100 }}</p>
                        <div class="noticia-meta">
                            <span>{{ noticia.data_publicacao|date:"d/m/Y" }}</span>
                        </div>
                    </div>
                </a>
            </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>Nenhuma notícia encontrada com esses filtros.</h3>
            <a href="{% url 'Echo_app:noticias_curtidas' %}" class="empty-btn-link">Limpar Filtros</a>
        </div>
    {% endif %}
</div>

{% endblock %}